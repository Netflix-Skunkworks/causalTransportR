<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>AIPW estimation under unconfoundedness — aipw • causalTransportR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="AIPW estimation under unconfoundedness — aipw"><meta property="og:description" content="Simplified version of `ateGT` with no selection indicator. Imputes counterfactual outcome for each observation i under each treament a as
$$Y^a = \frac{A = a}{\pi^a (X)} (Y - \hat{\mu}^a(X)) + \mu^a(X) $$
Average treatment effects are defined as averages of differences between counterfactual outcomes \(Y^a - Y^{a'}\).
and returns marginal means, causal contrasts, and their influence-function based variance estimates. Uses same underlying nuisance function fitter as `ateGT` with no missing data or surrogates."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">causalTransportR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/generalization.html">Effect Generalization</a>
    </li>
    <li>
      <a href="../articles/mlrate.html">Covariate Adjustment using ML predictions</a>
    </li>
    <li>
      <a href="../articles/omnibus.html">Omnibus Tests for Treatment Effect Heterogeneity</a>
    </li>
    <li>
      <a href="../articles/tech_details.html">Technical Details : identification and estimation</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>AIPW estimation under unconfoundedness</h1>
    
    <div class="hidden name"><code>aipw.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Simplified version of `ateGT` with no selection indicator. Imputes counterfactual outcome for each observation i under each treament a as
$$Y^a = \frac{A = a}{\pi^a (X)} (Y - \hat{\mu}^a(X)) + \mu^a(X) $$
Average treatment effects are defined as averages of differences between counterfactual outcomes \(Y^a - Y^{a'}\).
and returns marginal means, causal contrasts, and their influence-function based variance estimates. Uses same underlying nuisance function fitter as `ateGT` with no missing data or surrogates.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">aipw</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">a</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  treatProb <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nuisMod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rlm"</span>, <span class="st">"rf"</span><span class="op">)</span>,</span>
<span>  estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AIPW"</span>, <span class="st">"IPW"</span>, <span class="st">"OM"</span><span class="op">)</span>,</span>
<span>  hajekize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  separateMus <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  glmnet_lamchoice <span class="op">=</span> <span class="st">"lambda.min"</span>,</span>
<span>  glmnet_alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  glmnet_rho_family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  glmnet_pi_family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  glmnet_mu_family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  glmnet_parl <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  grf_tunerf <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  noi <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>y</dt>
<dd><p>outcome vector (may contain missings ; missings must correspond with s = 0)</p></dd>


<dt>a</dt>
<dd><p>treatment vector (no missings; can be relaxed with some tinkering)</p></dd>


<dt>X</dt>
<dd><p>covariate matrix (no missings)</p></dd>


<dt>treatProb</dt>
<dd><p>propensity score vector (of length n_treatment) or matrix (n_treatment X n_obs), where latter is for covariate adaptive designs; must sum to 1. NULL by default, so pscore is fitted. When provided, no propensity score is fit. With discrete covariates, estimated propensity score is advisable even if treatment was randomized.</p></dd>


<dt>nuisMod</dt>
<dd><p>one of c("rlm", "rf") : choose how to fit nuisance functions (cross-fit).</p></dd>


<dt>estimator</dt>
<dd><p>one of c("AIPW", "IPW", "OM"). The default is AIPW.</p></dd>


<dt>hajekize</dt>
<dd><p>boolean for whether to divide the inverse probability weights term for each treatment level by the sum of weights in that treatment level. This guards against instability from very large weights from extremely small selection or propensity scores.</p></dd>


<dt>separateMus</dt>
<dd><p>boolean for whether to fit separate outcome models for each treatment group or a single pooled model. The former is recommended and is the default, but a pooled model may be fit when data is scarce / computation is burdensome.</p></dd>


<dt>glmnet_lamchoice</dt>
<dd><p>choice of lambda (shrinkage parameter) for regularized linear regressions. Only relevant when nuisMod == "rlm"</p></dd>


<dt>glmnet_alpha</dt>
<dd><p>in [0, 1], choice of alpha in glmnet. 1 (default) corresponds with L1 regularization (LASSO) and 0 corresponds with L2 regularization (ridge), while intermediate values correspond with a mix of the two (elastic net)</p></dd>


<dt>glmnet_rho_family</dt>
<dd><p>GLM family for selection model. "binomial" by default but can be safely switched to "gaussian" for linear probability models with discrete covariates for faster compute</p></dd>


<dt>glmnet_pi_family</dt>
<dd><p>GLM family for propensity model. "binomial" by default but can be safely switched to "gaussian" for linear probability models with discrete covariates for faster compute</p></dd>


<dt>glmnet_mu_family</dt>
<dd><p>GLM family for outcome model. Gaussian by default.</p></dd>


<dt>glmnet_parl</dt>
<dd><p>Boolean for parallelization in glmnet. Need to enable parallelized cluster beforehand.</p></dd>


<dt>grf_tunerf</dt>
<dd><p>Tune rf hyperparameters? Passed to grf's regression forest. Use 'all' for hyperparameter tuning.</p></dd>


<dt>noi</dt>
<dd><p>boolean for printing marginal means and causal contrasts table (it gets returned anyway). off by default.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>list containing treatment effects table , nuisance function estimates, and influence function values</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># simulation with no selection bias (generate by passing null function for selection)</span></span></span>
<span class="r-in"><span><span class="va">df2</span> <span class="op">=</span> <span class="fu"><a href="selDGP.html">selDGP</a></span><span class="op">(</span>selF <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df2</span><span class="op">$</span><span class="va">tau</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># true effect : sinh(1)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.171758</span>
<span class="r-in"><span><span class="co"># lasso</span></span></span>
<span class="r-in"><span><span class="fu">aipw</span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">y</span>, <span class="va">df2</span><span class="op">$</span><span class="va">a</span>, <span class="va">df2</span><span class="op">$</span><span class="va">X</span>, noi <span class="op">=</span> <span class="cn">FALSE</span>, nuisMod <span class="op">=</span> <span class="st">"rlm"</span><span class="op">)</span><span class="op">$</span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      parameter      est         se     ci.ll    ci.ul pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      E{Y(0)} 1.053885 0.04317185 0.9692684 1.138502    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      E{Y(1)} 2.195108 0.03614675 2.1242603 2.265956    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 E{Y(1)-Y(0)} 1.141223 0.03409304 1.0744004 1.208045    0</span>
<span class="r-in"><span><span class="co"># random forest</span></span></span>
<span class="r-in"><span><span class="fu">aipw</span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">y</span>, <span class="va">df2</span><span class="op">$</span><span class="va">a</span>, <span class="va">df2</span><span class="op">$</span><span class="va">X</span>, noi <span class="op">=</span> <span class="cn">FALSE</span>, nuisMod <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span><span class="op">$</span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      parameter      est         se     ci.ll    ci.ul pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      E{Y(0)} 1.055843 0.04117360 0.9751427 1.136543    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      E{Y(1)} 2.193863 0.03577818 2.1237374 2.263988    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 E{Y(1)-Y(0)} 1.138020 0.02845892 1.0822401 1.193799    0</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Apoorva Lal.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

